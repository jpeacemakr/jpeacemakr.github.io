<!DOCTYPE html>
<html lang="en">
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
        <meta charset="utf-8">
        
        <title>Don't torpedo the whales!</title>
        <link rel="icon" type="image/x-icon" href="images/favicon.ico">
        <link rel="apple-touch-icon" sizes="114x114" href="images/apple-icon-114x114.png">

        <style>
            a {
                color: #4e7dad;
            }
            button {
                background-color: #0099ff;
                color: white;
                border-radius: 8px;
                border:none;
                padding: 8px;
                font-family: Arial, Helvetica, sans-serif;
                font-weight: bold;
                cursor:pointer;
            }
            button:hover {
                background-color: #62bcf9;
            }

            body {
                background-image: url('images/waves.svg');
                background-size: cover;
                background-repeat: no-repeat;
                background-attachment: fixed;
                font-family: Georgia;
            }
            
            .page {
                display: flex;
                flex-direction: column;
                align-items: center;
            }

            .header {
                width: 960px;
            }

            .header2 {
                width: 320px;
            }

            .center {
                display: flex;
                align-items: stretch;
                box-shadow: 3px 3px 10px 1px rgba(0, 0, 0, 0.2);
            }

            .words {
                text-align:left;
                background-color:#ffffff; 
                padding: 8px 20px 20px 20px; 
            }
           
            #canvasDivHolder {
                display:block;
                background-image: radial-gradient(#BBDDFF, #77AADD);
            }
            
            #canvasDiv {
                position:absolute;
            }
            
            #canvasDivPlayer {
                position:absolute;
            }

            #win {
                position: absolute;
                width: 800px;
                height:400px;
                z-index: 1;
            }

            #whale {
                position: absolute;
                width: 800px;
                height:400px;
                z-index: 1;
            }

            #submarine {
                position: absolute;
                width: 800px;
                height:400px;
                z-index: 1;
            }


            .show {
                top: 60px;
                left:calc(50% - 400px); 
                transition: top 2s;
                transition-timing-function: ease;
            }

            .hide {
                top: -800px;
                left:calc(50% - 400px); 
                transition: top 4s;
                transition-timing-function: ease;
            }


            #scoreWin {
                position: absolute;
                top: 300px;
                left: calc(50% - 150px);
                width: 300px;
                padding: 20px 20px 20px 20px;
                background-color: white;
                box-shadow: 3px 3px 10px 1px rgba(0, 0, 0, 0.2);
            }

            .footer {
                width: 960px;
                font-size: 12px;
                padding-top: 2px;
            }

            .arrow {
                opacity:75%;
                cursor: pointer;
                width: 80px;
                height: 80px;
            }
            .arrow:hover {
                opacity:50%;
            }
            .arrow:active {
                opacity:100%;
            }

            .image-swap {
                cursor: pointer;
                width:80px;
            }
            .image-swap>img, .image-swap:active>img:first-child {
                display: none;
            }
            .image-swap>img:first-child, .image-swap:active>img:last-child {
                display: block;
            }

            * {
                box-sizing:border-box;
            }

        </style>

        <script src="scripts/jquery.js"></script>
        <script src="scripts/jquery.cookie.js"></script>

    </head>


    <body onload=" startGame()" onkeydown="keyPressed(event)">

        <!-- audio files to be played -->
        <audio src="sounds/bomb.mp3" id="bombAudio"></audio>
        <audio src="sounds/whalehit.mp3" id="whaleHit"></audio> 
        <audio src="sounds/submarinehit.mp3" id="submarineHit"></audio> 
        <audio src="sounds/yay.mp3" id="yay"></audio> 
 
   
        <!-- splash screens. they start as hidden and then come down when called using show and hide functions -->
        <div id="win" class="hide">
            <img style ="width: 65%; display: block; margin-left: auto; margin-right: auto;" src="images/sky.svg">
            <div id="scoreWin"></div>
            <button style = "position: absolute; width:120px; top:420px; left:calc(50% - 60px);" onClick="hide('win'); startGame();">PLAY AGAIN</button>
        </div>

        <div id="whale" class="hide">
            <img style ="width: 55%; display: block; margin-left: auto; margin-right: auto;" src="images/whaleshot.svg">
            <button style = "position: absolute; width:120px; top:390px; left:calc(50% - 60px);" onClick="hide('whale');">CONTINUE</button>
        </div>

        <div id="submarine" class="hide">
            <img style ="width: 55%; display: block; margin-left: auto; margin-right: auto;" src="images/submarineshot.svg">
            <button style = "position: absolute; width:120px; top:400px; left:calc(50% - 60px);" onClick="hide('submarine');">CONTINUE</button>
        </div>


        <!-- begin visible page -->
        <div class = "page">
            
            <div class="header">
                <!-- Header -->
                <image src="images/periscopecropped.svg" style="width:120px;float:left; margin-left:20px; margin-right:20px" alt="persicope">
                <h1 style="position:absolute; margin-left:165px; margin-top:10px; font-size: 58px; text-shadow: 1px 1px 2px black; white-space: nowrap;"><span style="color:white">Don't torpedo the </span"><span style="color:#bedfff ">whales!</span></h1>
                <p style="font-family: Georgia; position:absolute; margin-left:170px; margin-top:75px; font-size: 15px; color:#4e7dad"><i>(An absurd game of luck and logic)</i></p>
            </div>
            <div class="header2">
                <!-- Header for mobile size. Smaller version with button to show the rules and score -->
                <image src="images/periscopecropped.svg" style="width:80px;float:left; margin-left:0px; margin-right:0px" alt="persicope">
                <h1 style="position:absolute; margin-left:25px; margin-top:12px; font-size: 21px; text-shadow: 1px 1px 2px black; white-space: nowrap;"><span style="color:white">Don't torpedo the </span"><span style="color:#bedfff ">whales!</span></h1>
                <p style="font-family: Georgia; position:absolute; margin-left:85px; margin-top:40px; font-size: 12px; color:#4e7dad"><i>(An absurd game of luck and logic) </i> <button id="info" style="position:inline; margin-left:5px; width:18px; font-size:9px; padding:3px; border-radius:12px;">?</button></p>
                <script>
                    $('#info').click(function() {
                        $('.rules').css({
                            'display': 'block'
                        });
                    });
                </script>
            </div>
            
            <!-- center section. the area between the header and the footer -->
            <div class="center">
                <!-- Words for the game -->
                <div class="words">

                    <div class="rules">
                        <p><b>Objective:</b> Your mission is to sink the 3 enemy submarines without hitting the 5 innocent whales. Sonar numbers (1-4) show how far a target is away from each shot after it is fired.</p>
                        <p><b>Scoring:</b> +1,000: Hitting an enemy submarine.<br> 
                            -100: Hitting a poor defenseless whale.<br>
                            -10: Missing a shot with a torpedo.<br>
                        </p>

                        <!-- Uses script to display the score -->
                        <h4 id="score"></h4>
                        
                        <!-- button to hide the rules and score in mobile size only -->
                        <button id="closeRules" style="margin:0 auto;">CLOSE</button>
                        <script>
                            $('#closeRules').click(function() {
                                $('.rules').css({
                                    'display': 'none',
                                });
                            });
                        </script>
                    </div>


                    <!-- The controls for large screen-->
                    <div class="controls" style="width:240px; height:240px; position:relative; margin:auto; background-image: url(images/circle.svg); background-size: 100%;">
                        <img class="arrow" src="images/arrow.svg" style="position:absolute; top:0px; left:80px;" onClick="myGamePiece.moveUp();">
                        <img class="arrow" src="images/arrow.svg" style="position:absolute; top:80px; left:0px; transform: rotate(-90deg);" onClick="myGamePiece.moveLeft();">
                        <img class="arrow" src="images/arrow.svg" style="position:absolute; top:80px; left: 160px; transform: rotate(90deg);" onClick="myGamePiece.moveRight();">
                        <img class="arrow" src="images/arrow.svg" style="position:absolute; top:160px; left: 80px; transform: rotate(180deg);" onClick="myGamePiece.moveDown();">
                        
                        <div class="image-swap" style="position:absolute; top:82px; left:80px;" onClick="myGamePiece.reveal();">
                            <img src="images/button.svg" style="width:80px; height:80px;"/>
                            <img src="images/buttonpushed.svg" style="width:80px; height:80px;"/>
                        </div>
                    </div>
                    <!-- The controls for small screen-->
                    <div class="controls2" style="width:300px; height:60px; position:relative; margin:auto;">
                        <img class="arrow" src="images/arrow.svg" style="position:absolute; top:5px; left:60px; width:60px; height:60px;" onClick="myGamePiece.moveUp();">
                        <img class="arrow" src="images/arrow.svg" style="position:absolute; top:5px; left:0px; width:60px; height:60px; transform: rotate(-90deg);" onClick="myGamePiece.moveLeft();">
                        <img class="arrow" src="images/arrow.svg" style="position:absolute; top:5px; left: 240px; width:60px; height:60px; transform: rotate(90deg);" onClick="myGamePiece.moveRight();">
                        <img class="arrow" src="images/arrow.svg" style="position:absolute; top:5px; left: 180px; width:60px; height:60px; transform: rotate(180deg);" onClick="myGamePiece.moveDown();">
                        
                        <div class="image-swap" style="position:absolute; top:5px; left:118px;" onClick="myGamePiece.reveal();">
                            <img src="images/button.svg" style="width:68px; height:68px;"/>
                            <img src="images/buttonpushed.svg" style="width:68px; height:68px;"/>
                        </div>
                    </div>
                    
                </div>
                <!-- The canvas where the game is drawn. One layer for the game board. One layer for the player game piece -->
                <div id="canvasDivHolder">
                    <div id="canvasDiv"></div>
                    <div id="canvasDivPlayer"></div>
                </div>
            </div>
            <div class="footer">
                <!-- Footer -->
                Version 1.4
            </div>
        </div>
    </body>
</html>



<script>

    ///////////////////////////////////
    // about
    // by James Peacemaker
    // the game is made up of a matrix of squares like a checkerboard
    // the game piece can move from one game square to another
    // it uses two overlapping canvases. one underneath for the game board and one on top for the player


    ////////////////////////////////////
    // game initialization variables
    var gameSquareSize = 20; // size of the game piece and game squares in pixels
    var gameSquareNumberX = 28; // number of X game squares (width)
    var gameSquareNumberY = 28; // number of Y game squares (height)
    var gridColor = "#6699CC";
    var targetNumber = 3; // the number of submarines
    var victimNumber = 5; // the number of whales


    ////////////////////////////////////////
    // used to get the size of the screen. used to set the number of squares on the game board
    var w = Math.min(window.screen.availWidth, window.innerWidth);
    console.log("width:" + w);

    var h = Math.min (window.screen.availHeight, window.innerHeight);
    console.log("height:" + h);
    
    // used to resize the game if screen is small
    function sizeFunction(x) {
        if (x.matches) { // If media query matches
            console.log("Small size screen");
            //gameSquareNumberX = 16;
            gameSquareNumberX = Math.floor((w-40)/20);
            //gameSquareNumberY = 16;
            gameSquareNumberY = Math.floor((h-190)/20);

            document.querySelector('.header').style.display = 'none';
            document.querySelector('.header2').style.display = 'block';
            document.querySelector('.center').style.flexDirection = 'column-reverse';
            document.querySelector('.center').style.width = gameSquareNumberX*20 + "px";
            document.querySelector('#canvasDivHolder').style.minWidth = gameSquareNumberX*20 + "px";
            document.querySelector('#canvasDivHolder').style.minHeight = gameSquareNumberY*20 + "px";
            document.querySelector('#canvasDivHolder').style.width = gameSquareNumberX*20 + "px";
            document.querySelector('#canvasDivHolder').style.height = gameSquareNumberY*20 + "px";
            document.querySelector('.rules').style.display = 'none';
            document.querySelector('.rules').style.position = 'absolute';
            document.querySelector('.rules').style.backgroundColor = '#FFFFCC';
            document.querySelector('.rules').style.padding = '8px 20px 20px 20px';
            document.querySelector('.rules').style.zIndex = '3';
            document.querySelector('.rules').style.width = (gameSquareNumberX*20) + "px";
            document.querySelector('.rules').style.height = (gameSquareNumberY*20)+88 + "px";
            document.querySelector('.rules').style.top = 80 + "px";
            document.querySelector('#closeRules').style.display = 'block';
            document.querySelector('.words').style.padding = '8px 0px 20px 0px';
            document.querySelector('.controls').style.display = 'none';
            document.querySelector('.controls2').style.display = 'block';
            document.querySelector('.footer').style.display = 'none';

        } else {
            console.log("large size screen");
            gameSquareNumberX = 28;
            gameSquareNumberY = 28;
            document.querySelector('.header').style.display = 'block';
            document.querySelector('.header2').style.display = 'none';
            document.querySelector('.center').style.flexDirection = 'row';
            document.querySelector('.center').style.width = '960px';
            document.querySelector('#canvasDivHolder').style.minWidth = gameSquareNumberX*20 + "px";
            document.querySelector('#canvasDivHolder').style.minHeight = gameSquareNumberY*20 + "px";
            document.querySelector('#canvasDivHolder').style.width = gameSquareNumberX*20 + "px";
            document.querySelector('#canvasDivHolder').style.height = gameSquareNumberY*20 + "px";
            document.querySelector('.rules').style.display = 'block';
            document.querySelector('.rules').style.position = '';
            document.querySelector('.rules').style.backgroundColor = '';
            document.querySelector('.rules').style.padding = '';
            document.querySelector('.rules').style.width = "";
            document.querySelector('.rules').style.height = "";
            document.querySelector('.rules').style.top = "";
            document.querySelector('#closeRules').style.display = 'none';
            document.querySelector('.words').style.padding = '8px 20px 20px 20px';
            document.querySelector('.controls').style.display = 'block';
            document.querySelector('.controls2').style.display = 'none';
            document.querySelector('.footer').style.display = 'block';
            
        }
    }

    var x = window.matchMedia("(max-width: 1000px)");
    sizeFunction(x); // Call listener function at run time
    x.addListener(sizeFunction); // Attach listener function on state changes




    /////////////////////////////////        
    // start the game. called from body onload()
    function startGame() {
        myScore.start();
        myGameArea.start();
        myGamePiece.start();
        myTargets.start();
        myGameArea.render();
        myGamePiece.render();
    }


    ///////////////////////////////
    // represents each square on the board. is used by myGameArea
    // number 1-5 corresponds to distance from target or victim. 0 for target. 9 for victim. 6-8 reserved for future.
    class GameSquare {
        // let mySquare = new GameSquare();
        constructor() {
            this.hidden = true;
            this.value = 5;
        }
        reveal() {
            this.hidden = false;
        }
    }


    //////////////////////////////
    // object to control the game board. it is a matrix of GameSquares
    var myGameArea = {
        // grid of game piece positions
        gameMatrix: new Array (gameSquareNumberX),
        
        // whether game area values should be revealed (cheat)
        revealValue: false,
        
        // canvas to draw into
        canvas : document.createElement("canvas"),
        
        // initializes the values of the game board then calls function to initialize game piece
        start : function() {
            // set canvas size to number of game square (x and y axis) times the size of each game square
            this.canvas.width = gameSquareNumberX * gameSquareSize;
            this.canvas.height = gameSquareNumberY * gameSquareSize;
            this.context = this.canvas.getContext("2d");
            document.getElementById("canvasDiv").appendChild(this.canvas);
            
            // turn array into square array of arrays
            for(let i=0; i<gameSquareNumberX; i++){
                this.gameMatrix[i] = new Array (gameSquareNumberY);
            }

            // initialize the game squares
            for(let i=0; i<gameSquareNumberX; i++){
                for(let j=0; j<gameSquareNumberY; j++){
                    this.gameMatrix[i][j] = new GameSquare();
                }
            }                          
        },

        // render the board                
        render : function() {
            
            // Can be used to create gradient background
            // var bgGradient = this.context.createRadialGradient(300, 300, 5, 300, 300, 500);
            // bgGradient.addColorStop(0, backgroundColor1);
            // bgGradient.addColorStop(1, backgroundColor2);
            // Fill with gradient
            // this.context.fillStyle = bgGradient;
            // this.context.fillRect(0, 0, this.canvas.width, this.canvas.height);
            
            // set grid style
            this.context.lineWidth = 1;
            this.context.strokeStyle = gridColor; 
            
            // draw grid horizontal lines
            for (var i=1; i < gameSquareNumberY; i++) {
                this.context.moveTo(0, i*gameSquareSize);
                this.context.lineTo(this.canvas.width, i*gameSquareSize);
                this.context.stroke();
            }
            // draw grid vertical lines
            for (var i=1; i < gameSquareNumberX; i++) {
                this.context.moveTo(i*gameSquareSize, 0);
                this.context.lineTo(i*gameSquareSize, this.canvas.height);
                this.context.stroke();
            }

            // draw board values
            this.context.font = '10pt Helvetica';
            this.context.fillStyle = "#000000";
            for (var i=0; i < gameSquareNumberX; i++) {
                for (var j=0; j < gameSquareNumberY; j++) {
                    if (this.gameMatrix[i][j].hidden == false){
                        if (this.gameMatrix[i][j].value == 1){
                            this.context.fillStyle = "red";
                            this.context.fillRect(i*gameSquareSize, j*gameSquareSize, gameSquareSize, gameSquareSize);
                            this.context.fillStyle = "black";
                            this.context.fillText(this.gameMatrix[i][j].value, i*gameSquareSize+6, j*gameSquareSize+16);
                        } else if (this.gameMatrix[i][j].value == 2){
                            this.context.fillStyle = "orange";
                            this.context.fillRect(i*gameSquareSize, j*gameSquareSize, gameSquareSize, gameSquareSize);
                            this.context.fillStyle = "black";
                            this.context.fillText(this.gameMatrix[i][j].value, i*gameSquareSize+6, j*gameSquareSize+16);
                        } else if (this.gameMatrix[i][j].value == 3){
                            this.context.fillStyle = "yellow";
                            this.context.fillRect(i*gameSquareSize, j*gameSquareSize, gameSquareSize, gameSquareSize);
                            this.context.fillStyle = "black";
                            this.context.fillText(this.gameMatrix[i][j].value, i*gameSquareSize+6, j*gameSquareSize+16);
                        } else if (this.gameMatrix[i][j].value == 4){
                            this.context.fillStyle = "lime";
                            this.context.fillRect(i*gameSquareSize, j*gameSquareSize, gameSquareSize, gameSquareSize);
                            this.context.fillStyle = "black";
                            this.context.fillText(this.gameMatrix[i][j].value, i*gameSquareSize+6, j*gameSquareSize+16);
                        } else if (this.gameMatrix[i][j].value == 0){
                            //this.context.fillStyle = "white";
                            this.postImage("./images/deadsubicon.jpg", i*gameSquareSize, j*gameSquareSize);
                        } else if (this.gameMatrix[i][j].value == 9){
                            //this.context.fillStyle = "purple";
                            this.postImage("./images/deadwhaleicon.jpg", i*gameSquareSize, j*gameSquareSize);
                        } else {
                            this.context.fillStyle = "#ddeeff";
                            this.context.fillRect(i*gameSquareSize, j*gameSquareSize, gameSquareSize, gameSquareSize);
                        }
                    }
                }
            }
        },

        // reveal the values on the game board (used for debugging and cheating)
        reveal : function() {
            if (this.revealValue == false) { // reveal board values
                // draw board values
                this.context.font = '10pt Helvetica';
                this.context.fillStyle = "#000000";
                for (var i=0; i < gameSquareNumberX; i++) {
                    for (var j=0; j < gameSquareNumberY; j++) {
                        this.context.fillText(this.gameMatrix[i][j].value, i*gameSquareSize+6, j*gameSquareSize+16);
                    }
                }
                this.revealValue = true;
            } else { // conceal board values
                this.revealValue = false;
                this.clear();
            }
        },

        // reset the game board and player
        clear : function() {
            this.context.clearRect(0, 0, this.canvas.width, this.canvas.height);
            this.render();
        },

        // post a photo at location x,y
        postImage : function (fileName, x, y){
            const img = new Image();        
            img.src = fileName;        
            img.onload = () => {          
                this.context.drawImage(img, x, y);        
            };
        }
    }



    ///////////////////////////////////////////
    // object to control the player's game piece
    var myGamePiece = {
        // default position, size and color
        x : 0,
        y : 0,
        // these values can be used for a fill-type player instead of an image-type player.
        // width : gameSquareSize,
        // height: gameSquareSize,
        // color : "red",
        context: myGameArea.context,
        canvas : document.createElement("canvas"),

        // set game piece at start                
        start : function() {
            this.x = Math.floor(gameSquareNumberX/2);
            this.y = Math.floor(gameSquareNumberY/2);

            // set canvas size to number of game square (x and y axis) times the size of each game square
            this.canvas.width = gameSquareNumberX * gameSquareSize;
            this.canvas.height = gameSquareNumberY * gameSquareSize;
            this.context = this.canvas.getContext("2d");
            document.getElementById("canvasDivPlayer").appendChild(this.canvas);

            // make game piece movable by mouse
            this.canvas.addEventListener("mousedown", doMouseDown, false);
        },

        // render the player again                
        render : function() {
            this.context.clearRect(0, 0, this.canvas.width, this.canvas.height);
            const imgCrosshair = new Image();        
            imgCrosshair.src = './images/crosshair.svg';        
            imgCrosshair.onload = () => {          
                this.context.drawImage(imgCrosshair, this.x*gameSquareSize-80, this.y*gameSquareSize-80);        
            };
        },

        // movement functions
        moveRight : function() {
            if (this.x*gameSquareSize+gameSquareSize<myGameArea.canvas.width){
                this.x= this.x + 1;
                this.render();
            }
        },
        moveLeft : function() {
            if (this.x>0){
                this.x= this.x - 1;
                this.render();
            }
        },
        moveUp : function() {
            if (this.y>0){
                this.y= this.y - 1;
                this.render();
            }
        },
        moveDown : function() {
            if ((this.y+1)*gameSquareSize < myGameArea.canvas.height){
                this.y= this.y + 1;
                this.render();
            }
        },

        // This is the bomb function. it reveals the spot on the map where the gamePiece is located.
        // It shows a bomb image in the location and then clears it one second later.
        // It then displays a splash screen (submarine or whale) if something was hit.
        reveal : async function() {
            if (myGameArea.gameMatrix[this.x][this.y].hidden == 1) { 
                myGameArea.gameMatrix[this.x][this.y].hidden = 0;
                playAudio("bombAudio");
                this.postImage("./images/bomb.jpg", myGamePiece.x*gameSquareSize, myGamePiece.y*gameSquareSize);
            
                myGameArea.render();

                // check if anything was hit and update score and targets left
                if (myGameArea.gameMatrix[this.x][this.y].value == 0) {
                    myTargets.targetRemaining--;
                    myScore.update(1000);
                    await sleep(1000).then(() => {  
                        this.render();
                    });
                    if (myTargets.targetRemaining == 0) {
                        // if no submarines are left
                        myScore.finish();
                    } else {
                        show("submarine"); // activate splash screen if sub is hit
                        await sleep(1000).then(() => {  
                            playAudio("submarineHit");
                        });  
                    } 
                } else if (myGameArea.gameMatrix[this.x][this.y].value == 9) {
                    myTargets.victimRemaining--;
                    myScore.update(-100);
                    await sleep(1000).then(() => {  
                        this.render();
                    });  
                    show("whale"); // activate splash screen if whale is hit
                    await sleep(1000).then(() => {  
                        playAudio("whaleHit");
                    });  
                } 
                else {
                    myScore.update(-10);
                    await sleep(1000).then(() => {  
                        this.render();
                    });  
                }
            }
        },
        
        // reset the player to starting position
        clear : function() {
            this.x = Math.floor(gameSquareNumberX/2);
            this.y = Math.floor(gameSquareNumberY/2);
        },

        // post a photo at location x,y
        postImage : function (fileName, x, y){
            const img = new Image();        
            img.src = fileName;        
            img.onload = () => {          
                this.context.drawImage(img, x, y);        
            };
        }
    }


    ///////////////////////////////////
    // object to initialize the targets and set distance values on the game board.
    var myTargets = {

        targetRemaining : targetNumber,
        victimRemaining : victimNumber,

        start : function() {
            this.targetRemaining = targetNumber;
            this.victimRemaining = victimNumber;
            this.setTarget();
            this.setVictims();
        },
        
        // create the targets and set the distance values in the game matrix               
        setTarget : function() {

            // pick random tile for a target
            // from 0 to gameSquareNumber-1 (0-29)
            var foundTargets = 0;
            while (foundTargets < targetNumber) {
                var targetX = Math.floor(Math.random() * gameSquareNumberX);
                var targetY = Math.floor(Math.random() * gameSquareNumberY); 
                // if target square is used, pick a new target
                if (myGameArea.gameMatrix[targetX][targetY].value != 0){
                    myGameArea.gameMatrix[targetX][targetY].value = 0;
                    foundTargets++;
                    // console.log("Debug: target position: " + (targetX+1) + " " + (targetY+1));
                    
                    // set distance values in the gameMaxtrix
                    //get area to be manipulated
                    var minX = targetX-4;
                    var maxX = targetX+4;
                    // console.log("Debug: X range to expand: " + minX + " " + maxX);

                    var minY = targetY-4;
                    var maxY = targetY+4;
                    // console.log("Debug: Y range to expand: " + minY + " " + maxY);
                
                    // make concentric passes to set distance from target
                    for (var pass = 1; pass < 5; pass++){
                        for (var i = minX; i <= maxX; i++){
                            for (var j = minY; j <= maxY; j++){
                                // console.log("Debug: expanding area: " + i + " " + j);
                                if ((i >=0 && i < gameSquareNumberX) && (j >=0 && j < gameSquareNumberY) && (myGameArea.gameMatrix[i][j].value <= 5)){
                                    myGameArea.gameMatrix[i][j].value = Math.min(myGameArea.gameMatrix[i][j].value, 5-pass);
                                }
                            }
                        }
                        minX++;
                        maxX--;
                        minY++;
                        maxY--;
                    }
                }
            }
        
        // create the victims (innocent bystanders) and set distance values in the game matrix
        }, setVictims : function() {
            // pick random tiles for victims
            // from 0 to gameSquareNumber-1 (0-29)
            // if target square is used, pick a new target
            var foundVictims = 0;
            while (foundVictims < victimNumber) {
                var targetX = Math.floor(Math.random() * gameSquareNumberX);
                var targetY = Math.floor(Math.random() * gameSquareNumberY); 
                // if victim square is used, pick a new victim
                if ((myGameArea.gameMatrix[targetX][targetY].value != 0) && (myGameArea.gameMatrix[targetX][targetY].value != 9)){
                    myGameArea.gameMatrix[targetX][targetY].value = 9;
                    foundVictims++;
                    // console.log("Debug: victim position: " + (targetX+1) + " " + (targetY+1));
                
                    // set distance values
                    //get area to be manipulated
                    var minX = targetX-4;
                    var maxX = targetX+4;
                    // console.log("Debug: X range to expand: " + minX + " " + maxX);

                    var minY = targetY-4;
                    var maxY = targetY+4;
                    // console.log("Debug: Y range to expand: " + minY + " " + maxY);

                    // make concentric passes to set distance from target
                    for (var pass = 1; pass < 5; pass++){
                        for (var i = minX; i <= maxX; i++){
                            for (var j = minY; j <= maxY; j++){
                                // console.log("Debug: expanding area: " + i + " " + j);
                                if ((i >=0 && i < gameSquareNumberX) && (j >=0 && j < gameSquareNumberY) && (myGameArea.gameMatrix[i][j].value <= 5)){
                                    myGameArea.gameMatrix[i][j].value = Math.min(myGameArea.gameMatrix[i][j].value, 5-pass);
                                }
                            }
                        }
                        minX++;
                        maxX--;
                        minY++;
                        maxY--;
                    }
                }
            }
        }
    }


    
    ////////////////////////////////////////////
    // object to control the scoreboard
    var myScore = {
        gameScore : 0,
        title : "Noob",
        
        // set score at start                
        start : function() {
            this.gameScore = 0;
            this.title = "Noob";
            
            cookieDate = new Date;
            cookieDate.setDate(cookieDate.getDate() + 365);

            if (typeof $.cookie('gamesplayed') === 'undefined'){
                $.cookie("gamesplayed", 0, { expires: cookieDate });
                $.cookie("highscore", 0, { expires: cookieDate });
                $.cookie("lowscore", 0, { expires: cookieDate });
                $.cookie("totalscore", 0, { expires: cookieDate });
            }
            this.setId("score");
        },

        // update score and title by amount change
        update : function(change) {
            this.gameScore = this.gameScore + change;
            if (this.gameScore > 2500){
                this.title = "Hero";
            } else if (this.gameScore > 2200) {
                this.title = "Sharpshooter";
            } else if (this.gameScore > 1500) {
                this.title = "Warrior";
            } else if (this.gameScore > 800) {
                this.title = "Completely adequate";
            } else if (this.gameScore > 500) {
                this.title = "Indiscriminate killer";
            } else if (this.gameScore > 0) {
                this.title = "Buffoon";
            } else if (this.gameScore > -100) {
                this.title = "Jinxed";
            } else if (this.gameScore > -250) {
                this.title = "Scourge of the sea";
            } else if (this.gameScore > -500) {
                this.title = "Eco-terrorist";
            } else {
                this.title = "War criminal";
            }
            this.setId("score");    
        }, 

        setId : function(name) {
            // set html to display scores
            document.getElementById(name).innerHTML = 
            "Score: " + myScore.gameScore + " (" + myScore.title + ")" + "<br>" + 
            "Games played: " + $.cookie("gamesplayed") + "<br>" +
            "Highest score: " + $.cookie("highscore") + "<br>" +
            "Lowest score: " + $.cookie("lowscore");

            // only include average score if games played is greater than 0. (can't divide by 0)
            if ((parseInt($.cookie("gamesplayed"))) != 0) {            
                document.getElementById(name).innerHTML += "<br>Average score: " + Math.round(parseInt($.cookie("totalscore"))/parseInt($.cookie("gamesplayed")));
            } else {
                document.getElementById(name).innerHTML += "<br>Average score: 0";
            }
        },
        
        finish : async function() {
            // show splash screen
            await sleep(1000).then(() => {  
                show("win");
                playAudio("yay");
            });

            // update cookie with score
            // set initial cookie values if cookie doesn't exist
            // get date for cookies to expire in one year
            cookieDate = new Date;
            cookieDate.setDate(cookieDate.getDate() + 365);

            if (typeof $.cookie('gamesplayed') === 'undefined' || $.cookie('gamesplayed') == 0){
                $.cookie("gamesplayed", 1, { expires: cookieDate });
                $.cookie("highscore", myScore.gameScore, { expires: cookieDate });
                $.cookie("lowscore", myScore.gameScore, { expires: cookieDate });
                $.cookie("totalscore", myScore.gameScore, { expires: cookieDate });
            } else {
                $.cookie("gamesplayed", parseInt($.cookie("gamesplayed"))+1, { expires: cookieDate }); // increment games played
                if (myScore.gameScore > $.cookie("highscore")){ // set new high score if higher
                    $.cookie("highscore", myScore.gameScore, { expires: cookieDate });
                }
                if (myScore.gameScore < $.cookie("lowscore")){ // set new low score if lower
                    $.cookie("lowscore", myScore.gameScore, { expires: cookieDate });
                }
                $.cookie("totalscore", parseInt($.cookie("totalscore"))+myScore.gameScore, { expires: cookieDate }); // add score to total score (will be used for average score)
            }
            console.log("gamesplayed: " + $.cookie("gamesplayed")); 
            console.log("highscore: " + $.cookie("highscore")); 
            console.log("lowscore: " + $.cookie("lowscore")); 
            console.log("totalscore: " + $.cookie("totalscore")); 
            
            this.setId("scoreWin");    
        }
    }



    /////////////////////////////////
    // used to detect keyboard button being pressed. Uses onkeydown() in body tag
    function keyPressed(event) {
        if (event.keyCode == 37) {
            myGamePiece.moveLeft();
            return true;
        } 
        else if (event.keyCode == 39) {
            myGamePiece.moveRight();
            return true;
        } 
        else if (event.keyCode == 38) {
            myGamePiece.moveUp();
            return true;
        } 
        else if (event.keyCode == 40) {
            myGamePiece.moveDown();
            return true;
        } 
        else if (event.keyCode == 70) { // f for fire
            myGamePiece.reveal();
            return true;
        } 
        else if (event.keyCode == 87) { // w for win
            myScore.finish();
            return true;
        } 
        else if (event.keyCode == 82) { // r for reveal
            myGameArea.reveal();
            return true;
        } 
        else {
            return false;
        }
    }

    
    /////////////////////////////////////
    // sets position of game piece based on mouse click
    function doMouseDown(event) {
        // get position of mouse on screen (position on page - amount page is scrolled)
        canvasX = event.pageX-window.scrollX;
        canvasY = event.pageY-window.scrollY;
        //console.log("Debug: screen mouse position " + canvasX + " " + canvasY);

        //subtract canvas position from mouse position on screen
        var rect = myGameArea.canvas.getBoundingClientRect();
        canvasX = canvasX - rect.left;
        canvasY = canvasY - rect.top;
        // console.log("Debug: canvas mouse position " + canvasX + " " + canvasY);
        
        // draw new position rounded to the nearest gameSquareSize
        myGamePiece.x = parseInt(canvasX/gameSquareSize);
        myGamePiece.y = parseInt(canvasY/gameSquareSize);

        myGamePiece.render();
    }


    ///////////////////////////////
    // sleep function
    let sleep = milliseconds => {  
        return new Promise(resolve => setTimeout(resolve, milliseconds));  
    };  


    ///////////////////////////////
    // plays sound. it uses id for embedded audio file
    function playAudio(name){
        document.getElementById(name).play();
    }
   


    ////////////////////////////////////
    // images
    
    // show the splash screen with the id of name. it changes the class of the win element
    function show(name) {
        var element = document.getElementById(name);
        element.classList.remove("hide");
        element.classList.add("show");
    }
    // hide the splash screen with the id of name. it changes the class of the win element
    function hide(name) {
        var element = document.getElementById(name);
        element.classList.remove("show");
        element.classList.add("hide");
    }

</script>



